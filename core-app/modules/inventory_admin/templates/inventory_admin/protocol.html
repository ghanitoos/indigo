{% extends "base.html" %}

{% block content %}
<div class="container mt-4 protocol-document">
  <div class="protocol-header">
    <div class="logo-top-right">
      {% if logo_url %}
        <img src="{{ logo_url }}" alt="Logo" class="logo">
      {% else %}
        <div class="logo-placeholder">Logo</div>
      {% endif %}
    </div>

    <div class="protocol-title-wrap">
      <div class="protocol-title-centered">{% if is_return %}Rückgabeprotokoll{% else %}Übergabeprotokoll{% endif %}</div>
    </div>

  </div>

  <div class="mt-1 proto-topline">
    <div class="proto-left">
      <div class="proto-label">Protokoll:</div>
      <div class="proto-value">{{ handover.protocol_number }}{% if is_return %}-RETURN{% endif %}</div>
    </div>
    <div class="proto-right">
      <div class="proto-label">Datum:</div>
      <div class="proto-value">{{ handover.handover_date.strftime('%d.%m.%Y') }}</div>
    </div>
  </div>

  <div class="protocol-meta mt-3">
    <div class="device-block">
      <div class="device-line"><strong>Gerät:</strong> {{ handover.device.device_type }} — {{ handover.device.model_name }} ({{ handover.device.inventory_number }})</div>
      <div class="device-line"><strong>Seriennummer:</strong> {{ handover.device.serial_number or '-' }}</div>
    </div>
  </div>

  <hr>

  <div class="party-row">
    <div class="party-col">
      <div class="party-title">Übergeber</div>
      {% set giver_name = (handover.giver.first_name or '') ~ ' ' ~ (handover.giver.last_name or '') %}
      <div class="party-name">{{ giver_name.strip() if giver_name.strip() else handover.giver.ldap_username }}</div>
      <div class="signature-block">
        <div class="signature-line"></div>
        <div class="signature-label">Name/Unterschrift Übergeber</div>
      </div>
    </div>
    <div class="party-col">
      <div class="party-title">Empfänger</div>
      <div class="party-name">{{ handover.receiver.first_name }} {{ handover.receiver.last_name }}</div>
      <div class="signature-block">
        <div class="signature-line"></div>
        <div class="signature-label">Name/Unterschrift Empfänger</div>
      </div>
    </div>
  </div>

  <hr>

  <div>
    {% if is_return and handover.return_date %}
      <p><strong>Datum der Rücknahme:</strong> {{ handover.return_date.strftime('%d.%m.%Y') }}</p>
    {% endif %}
    <h6>Notizen</h6>
    <pre style="white-space:pre-wrap">{{ handover.notes or '' }}</pre>
  </div>

  <div class="mt-3 no-print">
    <button class="btn btn-primary" onclick="window.print()">Drucken / Als PDF</button>
    {% if not handover.return_date %}
      <a class="btn btn-secondary" href="{{ url_for('inventory_admin.return_handover', handover_id=handover.id) }}">Rückgabe vermerken</a>
    {% endif %}
    <a class="btn btn-link" href="{{ url_for('inventory_admin.index') }}">Zurück</a>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/protocol.css') }}">
{% endblock %}
