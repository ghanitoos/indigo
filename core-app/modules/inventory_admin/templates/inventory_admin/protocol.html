{% extends "base.html" %}

{% block content %}
<div class="container mt-4 protocol-document">
  <div class="protocol-header">
    <div style="flex:1;">
      <div class="protocol-title">{% if is_return %}Rückgabeprotokoll{% else %}Übergabeprotokoll{% endif %}</div>
    </div>
    <div style="text-align:right; margin-left:12px;">
      <div><strong>Protokoll:</strong></div>
      <div class="proto-number" style="font-weight:600; margin-bottom:6px">{{ handover.protocol_number }}{% if is_return %}-RETURN{% endif %}</div>
      <div><strong>Datum:</strong> {{ handover.handover_date.strftime('%d.%m.%Y') }}</div>
    </div>
    <div class="flex-shrink-0 logo-container">
      {% if logo_url %}
        <img src="{{ logo_url }}" alt="Logo" class="logo">
      {% else %}
        <div class="logo-placeholder">Logo</div>
      {% endif %}
    </div>
  </div>

  <div class="protocol-meta mt-3">
    <table class="protocol-table">
      <tr>
        <td style="width:50%; vertical-align:top;"><strong>Gerät:</strong> {{ handover.device.device_type }} — {{ handover.device.model_name }} ({{ handover.device.inventory_number }})</td>
        <td style="vertical-align:top;"><strong>Seriennummer:</strong> {{ handover.device.serial_number or '-' }}</td>
      </tr>
    </table>
  </div>

  <hr>

  <div class="row">
    <div class="col-6">
      <h5>Übergeber</h5>
      {% set giver_name = (handover.giver.first_name or '') ~ ' ' ~ (handover.giver.last_name or '') %}
      <div>{{ giver_name.strip() if giver_name.strip() else handover.giver.ldap_username }}</div>
      <div class="signature-block">
        <div class="signature-line"></div>
        <div class="signature-label">Name/Unterschrift Übergeber</div>
      </div>
    </div>
    <div class="col-6">
      <h5>Empfänger</h5>
      <div>{{ handover.receiver.first_name }} {{ handover.receiver.last_name }}</div>
      <div class="text-muted">{{ handover.receiver.ldap_username }}</div>
      <div class="signature-block">
        <div class="signature-line"></div>
        <div class="signature-label">Name/Unterschrift Empfänger</div>
      </div>
    </div>
  </div>

  <hr>

  <div>
    {% if is_return and handover.return_date %}
      <p><strong>Datum der Rücknahme:</strong> {{ handover.return_date.strftime('%d.%m.%Y') }}</p>
    {% endif %}
    <h6>Notizen</h6>
    <pre style="white-space:pre-wrap">{{ handover.notes or '' }}</pre>
  </div>

  <div class="mt-3 no-print">
    <button class="btn btn-primary" onclick="window.print()">Drucken / Als PDF</button>
    {% if not handover.return_date %}
      <a class="btn btn-secondary" href="{{ url_for('inventory_admin.return_handover', handover_id=handover.id) }}">Rückgabe vermerken</a>
    {% endif %}
    <a class="btn btn-link" href="{{ url_for('inventory_admin.index') }}">Zurück</a>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/protocol.css') }}">
{% endblock %}
